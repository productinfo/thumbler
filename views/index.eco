<!DOCTYPE html>
<html>
  <head>
    <title>Latest thumbs</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/stylesheets/list.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div id="wrap">
      <div class="general-stats">
        <div class="alltime">
          <div class="label">All time:</div>
          <div class="count-pos"><%= @countPos %></div>
          <div class="count-neg"><%= @countNeg %></div>
        </div>
        <div class="lastweek">
          <div class="label">Last week:</div>
          <div class="count-pos"><%= @countPosWeek %></div>
          <div class="count-neg"><%= @countNegWeek %></div>
        </div>
      </div>
      <h1>Latest thumbs</h1>
      <form action="?" class="filter" method="GET">
        <input type="text" name="agent" id="id_agent" placeholder="Agent filter" value="<%= @agentFilter %>" />
        <input type="text" name="case" id="id_case" placeholder="Case/Customer filter" value="<%= @caseFilter %>" />
        <button type="submit">Filter</button>
        <% if @agentFilter or @caseFilter: %>
          <button type="button" class="clear" onclick="document.location='?'">Clear</button>
        <% end %>
      </form>
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Rating</th>
            <th>Case</th>
            <th>Agent</th>
            <th>User name</th>
            <th>User e-mail</th>
            <th>Feedback</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <% for thumb, i in @thumbs: %>
            <tr class="<%= if thumb.rating > 0 then 'positive' else if thumb.rating < 0 then 'negative' else 'non-standard-rating' %>">
              <td class="td-index"><%- Math.max(0, @page-1) * @perPage + i+1 %></td>
              <td class="td-rating"><%= if thumb.rating > 0 then ':)' else ':(' %></td>
              <td><a href="<%= @getCaseLink(thumb) %>" target="_blank"><%= @getCaseId(thumb) %></a></td>
              <td><%= thumb.agent?.name %></td>
              <td><%= thumb.user?.name %></td>
              <td><%= thumb.user?.email %></td>
              <td class="td-feedback">
                <%= @truncateFeedback(thumb.feedback) %>
                <% if thumb.feedback: %><pre class="full"><%= thumb.feedback %></pre><% end %>
              </td>
              <td><%= @formatDate(thumb.createdAt) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <p class="pagination">
        <% if @page > 1: %>
          <a href="<%= @paginate.href(true) %>" class="prev">&laquo; Previous</a>
          ...
        <% end %>
        <span class="current">(<%= @page %>/ <%= @totalPages %>)</span>
        <% if @page < @totalPages: %>
          ...
          <a href="<%= @paginate.href(false) %>" class="next">Next &raquo;</a>
        <% end %>
      </p>
    </div>
  </body>
</html>