<!DOCTYPE html>
<html>
  <head>
    <title>Latest thumbs</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <style>
      html {
        font-family: Ubuntu, sans-serif;
        font-size: 13px;
      }
      body {
        padding: 20px;
        background: #eee;
      }
      a:link, a:visited {
        color: #000;
      }
      #wrap {
        background: white;
        padding: 40px;
      }
      pre {
        margin: 20px 0;
        padding: 20px;
        background: #efefef;
      }
      .general-stats {
        float: right;
        margin: 0 -10px;
      }
      .general-stats .label {
        float: left;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
      }
      .lastweek, .alltime {
        float: right;
        margin: 10px 10px 10px 10px;
        overflow: auto;
      }
      .count-pos, .count-neg {
        float: left;
        padding: 10px 20px;
        margin: 0 0 0 10px;
        font-size: 16px;
        font-weight: bold;
      }
      .count-pos {
        background: #C7E8C7;
      }
      .count-neg {
        background: #FFB6B6;
      }
      table {
        margin: 20px 0px;
        border-collapse: collapse;
        width: 100%;
      }
      table td, table th {
        padding: 6px 10px;
        text-align: left;
      }
      table th {

      }
      table tr.positive {
        background: #C7E8C7;
      }
      table tr.negative {
        background: #FFB6B6;
      }
      table tr.non-standard-rating {
        background: #aaaaaa;
      }
      table thead tr {
        border-bottom: 4px solid #eee;
      }
      table tbody tr:hover {
        opacity: .8;
      }
      .td-rating {
        font-family: "Courier new", sans-serif;
      }
      .td-index {
        text-align: right;
        color: #666;
      }
      .pagination {
        margin: 20px 0px;
      }
      .pagination a:link, .pagination a:visited, .pagination span {
        display: inline-block;
        padding: 5px 10px;
        background: #eee;
        text-decoration: none;
        color: #333;
      }
      .pagionation .current {
        font-weight: bold;
      }
      input[type=text], textarea, select {
        border: 1px solid #ccc;
        padding: 8px 12px;
        font-size: 13px;
        color: #555;
      }
      button {
        border: none;
        padding: 9px 13px;
        font-size: 13px;
        color: #333;
      }
      button[type=submit] {
        background: #4bc800;
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
      form.filter input {
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div id="wrap">
      <div class="general-stats">
        <div class="alltime">
          <div class="label">All time:</div>
          <div class="count-pos"><%= @countPos %></div>
          <div class="count-neg"><%= @countNeg %></div>
        </div>
        <div class="lastweek">
          <div class="label">Last week:</div>
          <div class="count-pos"><%= @countPosWeek %></div>
          <div class="count-neg"><%= @countNegWeek %></div>
        </div>
      </div>
      <h1>Latest thumbs</h1>
      <form action="?" class="filter" method="GET">
        <input type="text" name="agent" id="id_agent" placeholder="Agent filter" value="<%= @agentFilter %>" />
        <input type="text" name="case" id="id_case" placeholder="Case/Customer filter" value="<%= @caseFilter %>" />
        <button type="submit">Filter</button>
      </form>
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Rating</th>
            <th>Case</th>
            <th>Agent</th>
            <th>User name</th>
            <th>User e-mail</th>
            <th>User company</th>
            <th>User IP</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          <% for thumb, i in @thumbs: %>
            <tr class="<%= if thumb.rating > 0 then 'positive' else if thumb.rating < 0 then 'negative' else 'non-standard-rating' %>">
              <td class="td-index"><%- Math.max(0, @page-1) * @perPage + i+1 %></td>
              <td class="td-rating"><%= if thumb.rating > 0 then ':)' else ':(' %></td>
              <td><a href="<%= @getCaseLink(thumb) %>" target="_blank"><%= @getCaseId(thumb) %></a></td>
              <td><%= thumb.agent?.name %></td>
              <td><%= thumb.user?.name %></td>
              <td><%= thumb.user?.email %></td>
              <td><%= thumb.user?.company %></td>
              <td><%= thumb.user?.ip %></td>
              <td><%= @formatDate(thumb.createdAt) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <p class="pagination">
        <% if @page > 1: %>
          <a href="<%= @paginate.href(true) %>" class="prev">&laquo; Previous</a>
          ...
        <% end %>
        <span class="current">(<%= @page %>/ <%= @totalPages %>)</span>
        <% if @page < @totalPages: %>
          ...
          <a href="<%= @paginate.href(false) %>" class="next">Next &raquo;</a>
        <% end %>
      </p>
    </div>
  </body>
</html>